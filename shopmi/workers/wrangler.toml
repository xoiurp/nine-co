# Wrangler Configuration for ShopMi Edge Workers
# Documentation: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "shopmi-edge"
main = "src/index.ts"
compatibility_date = "2024-10-20"
workers_dev = true

# Node.js compatibility
node_compat = false

# Account ID (obtenha em: dash.cloudflare.com -> Workers -> Overview)
# account_id = "YOUR_ACCOUNT_ID_HERE"

# ============================================
# Environment Variables (não sensíveis)
# ============================================
[vars]
ORIGIN_URL = "https://your-site.com"  # URL do Next.js
SHOPIFY_DOMAIN = "your-store.myshopify.com"
ENVIRONMENT = "development"

# ============================================
# Workers AI Binding
# ============================================
[ai]
binding = "AI"

# ============================================
# KV Namespace for Cache
# ============================================
# [[kv_namespaces]]
# binding = "CACHE"
# id = "YOUR_KV_ID"
# preview_id = "YOUR_PREVIEW_KV_ID"

# ============================================
# D1 Database for Analytics
# ============================================
# [[d1_databases]]
# binding = "DB"
# database_name = "shopmi-analytics"
# database_id = "YOUR_D1_DATABASE_ID"

# ============================================
# R2 Bucket for Image Cache (Opcional)
# ============================================
# [[r2_buckets]]
# binding = "IMAGES"
# bucket_name = "shopmi-images"
# preview_bucket_name = "shopmi-images-preview"

# ============================================
# Observability
# ============================================
[observability]
enabled = true

# ============================================
# Development Environment
# ============================================
[env.development]
name = "shopmi-edge-dev"
vars = { ORIGIN_URL = "https://your-site.com", SHOPIFY_DOMAIN = "your-store.myshopify.com", ENVIRONMENT = "development" }

# Herdar bindings do top level
[env.development.ai]
binding = "AI"

# [[env.development.kv_namespaces]]
# binding = "CACHE"
# id = "YOUR_KV_ID"
# preview_id = "YOUR_PREVIEW_KV_ID"

# [[env.development.d1_databases]]
# binding = "DB"
# database_name = "shopmi-analytics"
# database_id = "YOUR_D1_DATABASE_ID"

# ============================================
# Staging Environment
# ============================================
[env.staging]
name = "shopmi-edge-staging"
vars = { ORIGIN_URL = "https://your-site.com", ENVIRONMENT = "staging" }

# Route para staging (configurar após ter domínio)
# route = { pattern = "staging.your-site.com/*", zone_name = "your-site.com" }

# ============================================
# Production Environment
# ============================================
[env.production]
name = "shopmi-edge-production"
vars = { ORIGIN_URL = "https://your-site.com", ENVIRONMENT = "production" }

# Route para production (configurar após ter domínio)
# route = { pattern = "suaoja.com/*", zone_name = "suaoja.com" }

# Workers AI em production (se diferente)
# [env.production.ai]
# binding = "AI"

# KV em production
# [[env.production.kv_namespaces]]
# binding = "CACHE"
# id = "SEU_KV_PRODUCTION_ID"

# D1 em production
# [[env.production.d1_databases]]
# binding = "DB"
# database_name = "shopmi-analytics"
# database_id = "SEU_D1_PRODUCTION_ID"

# ============================================
# Build Configuration
# ============================================
# Wrangler compila TypeScript automaticamente, não precisa de build customizado
# [build]
# command = "npm run build"

# ============================================
# Limits & Performance
# ============================================
# limits = { cpu_ms = 50 }  # Timeout em ms (max 50000 para paid plan)

# ============================================
# Secrets (configurar via CLI)
# ============================================
# Execute os comandos abaixo para configurar secrets:
# wrangler secret put CF_IMAGES_TOKEN
# wrangler secret put CF_ACCOUNT_HASH
# wrangler secret put AI_GATEWAY_TOKEN (opcional)

# ============================================
# Tail Consumers (Logging - Opcional)
# ============================================
# [[tail_consumers]]
# service = "shopmi-edge-logger"
